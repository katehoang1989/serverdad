#!/bin/bash

# DIR Setup
export DIR="$( cd "$(dirname "$0")" ; pwd -P )"
export APPDIR=$DIR/apps
export SCRIPTS=$DIR/scripts
export CONTAINER=$SCRIPTS/container
export SETUP=$SCRIPTS/setup
export BACKUPDIR=$DIR/backups
export ENVFILE=$SCRIPTS/.env

# File Setup
export COMPOSEFILE=$DIR/docker-compose.yml

echo ""
echo "=========================================================================="
echo "  _____                     ____        _ "
echo " |   __|___ ___ _ _ ___ ___|    \ ___ _| |"
echo " |__   | -_|  _| | | -_|  _|  |  | .'| . |"
echo " |_____|___|_|  \_/|___|_| |____/|__,|___|"
echo " "
echo " While we wait let me tell you a joke: "
echo ""
printf " "
curl -H 'Accept: text/plain' https://icanhazdadjoke.com/
echo ""
echo ""
echo "=========================================================================="
echo ""

# Check if docker is installed before we do a lot of docker things
if ! dpkg -s docker &> /dev/null
then
        sudo apt install docker docker-compose -y
fi

if [ ! -f "$DIR/.env" ]
then
	$SETUP/envCreation.sh
else
	# Main Execution Loop
	while [ "$1" != "" ]
	do
		case $1 in
			-r | --run )
				shift
				$CONTAINER/start.sh $1
				shift
			;;
			-s | --stop )
				shift
				$CONTAINER/stop.sh $1
				shift
			;;
			-u | --update )
				shift
				$CONTAINER/update.sh $1
				shift
			;;
			-ps | --show )
				shift
				$CONTAINER/status.sh $1
				shift
			;;
			-e | --exec )
				shift
				$CONTAINER/exec.sh $1
				shift
			;;
			-i | --initilize )
				shift
				$SCRIPTS/initilize.sh
				shift
			;;
			-b | --backup )
				shift
				$SCRIPTS/backup.sh
				shift
			;;
			-re | --restore )
				shift
				$SCRIPTS/restore.sh
				shift
			;;
			-sy | --sync )
				shift
				$SCRIPTS/sync.sh
				shift
			;;
		esac
	done
fi

echo ""